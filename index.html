<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Native Functions Documentation</title>
        <!-- <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.10.0/styles/github-dark.min.css" /> -->
        <!-- <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.10.0/styles/atom-one-dark.min.css" /> -->
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.10.0/styles/tokyo-night-dark.min.css" />

        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.10.0/highlight.min.js"></script>

        <style>
            @import url("https://fonts.googleapis.com/css2?family=Tomorrow:wght@300;400;500;600;700&display=swap");
            @import url("https://fonts.googleapis.com/css2?family=Barlow:wght@400;500;600;700&display=swap");

            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
            }

            /* ===== CORE ===== */
            body {
                font-family: "Barlow", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
                background: linear-gradient(180deg, #0a0a0a 0%, #161616 100%);
                color: #ffffff;
                height: 100vh;
                display: flex;
                flex-direction: column;
                overflow: hidden;
                -webkit-font-smoothing: antialiased;
                -moz-osx-font-smoothing: grayscale;
            }

            #root {
                height: 100vh;
                display: flex;
                flex-direction: column;
            }

            /* ===== TYPOGRAPHY ===== */
            h1,
            h2 {
                font-family: "Tomorrow", "Barlow", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            }

            h1 {
                font-weight: 600;
            }

            /* ===== HEADER ===== */
            .header {
                background: rgba(10, 10, 10, 0.9);
                backdrop-filter: blur(12px);
                -webkit-backdrop-filter: blur(12px);
                padding: 1.25rem 2rem;
                border-bottom: 1px solid #161616;
                position: sticky;
                top: 0;
                z-index: 100;
                display: flex;
                align-items: center;
                gap: 2rem;
            }

            .header-main {
                flex: 1;
                display: flex;
                flex-direction: column;
                gap: 0.75rem;
            }

            .search-container {
                width: 60%;
                margin: 0 auto 0 auto;
            }

            .description-context {
                font-size: 0.95rem;
                color: #bbbbbb;
                line-height: 1.6;
                margin-bottom: 1.5rem;
                max-width: 720px;
            }

            /* ===== BRAND LOGO (Minimal) ===== */
            .brand-logo {
                display: flex;
                align-items: center;
            }

            .brand-logo img {
                height: 32px; /* adjust to your visual preference */
                width: auto;
                object-fit: contain;
                display: block;
            }

            .search-bar {
                width: 100%;
                padding: 0.875rem 1.25rem;
                background: #161616;
                border: 1px solid #222222;
                border-radius: 12px;
                color: #ffffff;
                font-size: 0.9rem;
                font-family: inherit;
                transition: all 0.2s ease;
            }

            .search-bar::placeholder {
                color: #595959;
            }

            .search-bar:hover {
                border-color: #3b3b3b;
                background: #161616;
            }

            .search-bar:focus {
                outline: none;
                border-color: #f5d90a;
                background: rgba(245, 217, 10, 0.08); /* Yellow Accent */
                box-shadow: 0 0 0 3px rgba(245, 217, 10, 0.3);
            }

            .filter-bar {
                display: flex;
                justify-content: center;
                gap: 1.5rem;
                align-items: center;
                flex-wrap: wrap;
            }

            .filter-group {
                display: flex;
                align-items: center;
                gap: 0.5rem;
                font-size: 0.8rem;
                color: #bbbbbb;
            }

            .filter-group label {
                font-weight: 500;
            }

            .filter-select {
                padding: 0.5rem 0.75rem;
                background: #161616;
                border: 1px solid #222222;
                border-radius: 8px;
                color: #ffffff;
                font-size: 0.8rem;
                font-family: inherit;
                cursor: pointer;
                transition: all 0.15s ease;
            }

            .filter-select option {
                background-color: #0a0a0a;
                color: #ffffff;
            }

            .filter-select:hover {
                border-color: #3b3b3b;
            }

            .filter-select:focus {
                outline: none;
                border-color: #f5d90a;
            }

            /* ===== MAIN LAYOUT ===== */
            .main-container {
                display: flex;
                flex: 1;
                min-height: 0;
            }

            /* ===== SIDEBAR ===== */
            .function-list {
                width: 320px;
                background: #0a0a0a;
                border-right: 1px solid #161616;
                overflow-y: auto;
                padding: 0.5rem;
            }

            .function-item {
                padding: 0.875rem 1rem;
                margin: 0.25rem 0;
                border-radius: 10px;
                cursor: pointer;
                transition: all 0.15s ease;
                border: 1px solid transparent;
            }

            .function-item:hover {
                background: #161616;
            }

            .function-item.active {
                background: linear-gradient(135deg, rgba(245, 217, 10, 0.2) 0%, /* Yellow Accent */ rgba(0, 250, 123, 0.16) 100% /* Green Accent */);
                border-color: rgba(245, 217, 10, 0.5);
            }

            .function-name {
                font-size: 0.9rem;
                font-weight: 500;
                color: #ffffff;
                letter-spacing: -0.01em;
            }

            .function-item.active .function-name {
                color: #f5d90a;
            }

            .function-meta {
                font-size: 0.75rem;
                color: #bbbbbb;
                margin-top: 0.35rem;
                font-weight: 400;
            }

            /* ===== DETAIL PANEL ===== */
            .detail-panel {
                flex: 1;
                padding: 2.5rem 3rem;
                overflow-y: auto;
                background: linear-gradient(135deg, #0a0a0a 0%, #161616 100%);
            }

            .detail-content h1 {
                font-size: 2.25rem;
                font-weight: 700;
                letter-spacing: -0.03em;
                background: linear-gradient(135deg, #ffffff 0%, #595959 100%);
                -webkit-background-clip: text;
                -webkit-text-fill-color: transparent;
                background-clip: text;
                margin-bottom: 0.75rem;
            }

            .category-badge {
                display: inline-flex;
                align-items: center;
                background: #161616;
                padding: 0.35rem 0.85rem;
                border-radius: 100px;
                font-size: 0.75rem;
                font-weight: 500;
                color: #595959;
                margin-bottom: 2rem;
                letter-spacing: 0.02em;
                text-transform: uppercase;
            }

            /* ===== FUNCTION CARDS ===== */
            .class-functions {
                display: flex;
                flex-direction: column;
                gap: 1rem;
            }

            .function-card {
                background: #0a0a0a;
                border-radius: 16px;
                padding: 1.5rem;
                border: 1px solid #222222;
                transition: all 0.2s ease;
            }

            /* .function-card:hover {
                border-color: #3b3b3b;
                background: #161616;
                transform: translateY(-1px);
            } */

            .function-card-header {
                display: flex;
                justify-content: space-between;
                align-items: flex-start;
                margin-bottom: 0.75rem;
                gap: 1rem;
            }

            .function-card-header h2 {
                font-size: 1rem;
                font-weight: 600;
                color: #ffffff;
                font-family: "Tomorrow", "Barlow", sans-serif;
                letter-spacing: -0.01em;
            }

            .function-badges {
                display: flex;
                gap: 0.5rem;
                flex-shrink: 0;
            }

            .function-description {
                font-size: 0.875rem;
                color: #bbbbbb;
                line-height: 1.6;
                margin-bottom: 1.25rem;
            }

            /* ===== BADGES ===== */
            .api-set-badge,
            .type-badge {
                display: inline-flex;
                align-items: center;
                padding: 0.25rem 0.625rem;
                font-size: 0.7rem;
                font-weight: 500;
                border-radius: 6px;
                letter-spacing: 0.02em;
                text-transform: uppercase;
            }

            /* API set badges */
            .api-set-badge.client {
                background: rgba(0, 250, 123, 0.2); /* Green Accent */
                color: #00fa7b;
            }

            .api-set-badge.server {
                background: rgba(245, 217, 10, 0.2); /* Yellow Accent */
                color: #f5d90a;
            }

            .api-set-badge.shared {
                background: rgba(59, 59, 59, 0.6);
                color: #ffffff;
            }

            /* Type badges */
            .type-badge.native {
                background: rgba(245, 217, 10, 0.2);
                color: #f5d90a;
            }

            .type-badge.constructor {
                background: rgba(0, 250, 123, 0.2);
                color: #00fa7b;
            }

            .type-badge.engine {
                background: rgba(229, 72, 77, 0.2); /* Red Accent */
                color: #e5484d;
            }

            /* ===== SECTIONS ===== */
            .section-title {
                font-size: 0.7rem;
                font-weight: 600;
                color: #595959;
                text-transform: uppercase;
                letter-spacing: 0.08em;
                margin-top: 1.25rem;
                margin-bottom: 0.75rem;
                padding-bottom: 0.5rem;
                border-bottom: 1px solid #222222;
            }

            /* ===== PARAMETERS ===== */
            .param-list,
            .return-list {
                list-style: none;
                margin: 0.75rem 0;
                padding-left: 0;
                font-size: 0.9375rem;
            }

            .param-list li,
            .return-list li {
                padding: 0.875rem 1rem;
                background: #161616;
                border: 1px solid #222222;
                margin-bottom: 0.5rem;
                border-radius: 6px;
                transition: all 0.15s ease;
            }

            .param-name {
                font-weight: 500;
                color: #f5d90a;
                font-size: 0.8rem;
            }

            .param-type {
                color: #00fa7b;
                font-size: 0.8rem;
            }

            .param-name,
            .param-type {
                font-family: "JetBrains Mono", monospace;
            }

            .param-modifier {
                font-size: 0.7rem;
                color: #f5d90a;
                font-weight: 500;
                background: rgba(245, 217, 10, 0.1);
                padding: 0.15rem 0.4rem;
                border-radius: 4px;
            }

            /* ===== PROPERTIES ===== */
            .property-list {
                list-style: none;
                margin: 0.75rem 0 1.5rem;
                padding: 0;
                border-radius: 12px;
                background: #161616;
                border: 1px solid #222222;
                overflow: hidden;
            }

            .property-list li {
                display: grid;
                grid-template-columns: minmax(0, 1fr) auto;
                grid-template-rows: auto auto;
                grid-template-areas:
                    "name type"
                    "description description";
                gap: 0.15rem 0.75rem;
                padding: 0.75rem 1rem;
                border-bottom: 1px solid #222222;
                font-size: 0.85rem;
                line-height: 1.4;
            }

            .property-list li:last-child {
                border-bottom: none;
            }

            .property-name {
                grid-area: name;
                font-weight: 600;
                font-size: 0.9rem;
                color: #ffffff;
                white-space: nowrap;
                overflow: hidden;
                text-overflow: ellipsis;
                font-family: "Tomorrow", "Barlow", sans-serif;
            }

            .property-type {
                grid-area: type;
                justify-self: end;
                align-self: center;
                font-size: 0.75rem;
                font-family: "JetBrains Mono", monospace;
                padding: 0.15rem 0.55rem;
                border-radius: 999px;
                border: 1px solid rgba(245, 217, 10, 0.6);
                background: rgba(245, 217, 10, 0.14);
                color: #f5d90a;
                text-transform: none;
            }

            .property-description {
                grid-area: description;
                font-size: 0.8rem;
                color: #bbbbbb;
            }

            .dim {
                color: #595959;
                font-size: 0.85rem;
                font-style: italic;
            }

            /* ===== STATES ===== */
            .loading {
                padding: 2rem;
                color: #595959;
                text-align: center;
                font-size: 0.9rem;
            }

            .no-selection {
                display: flex;
                flex-direction: column;
                align-items: center;
                justify-content: center;
                height: 100%;
                color: #3b3b3b;
                gap: 0.75rem;
            }

            .no-selection h2 {
                font-weight: 500;
                font-size: 1rem;
            }

            .no-selection::before {
                content: "";
                width: 48px;
                height: 48px;
                background: linear-gradient(135deg, rgba(245, 217, 10, 0.2) 0%, rgba(0, 250, 123, 0.2) 100%);
                border-radius: 12px;
                margin-bottom: 0.5rem;
            }

            /* ===== CODE BLOCKS ===== */
            .code-block-wrapper {
                border: 1px solid #222222;
                border-radius: 12px;
                background: #0a0a0a;
                margin-top: 0.75rem;
                overflow: hidden;
            }

            .code-label {
                background: #161616;
                color: #595959;
                font-size: 0.7rem;
                padding: 0.5rem 0.8rem 0.5rem 1rem;
                border-bottom: 1px solid #222222;
                font-family: "JetBrains Mono", monospace;
                font-weight: 500;
                text-transform: uppercase;
                letter-spacing: 0.05em;
                display: flex;
                align-items: center;
                justify-content: space-between;
                gap: 0.75rem;
            }

            .code-copy-button {
                border: none;
                outline: none;
                cursor: pointer;
                font-size: 0.7rem;
                font-family: "JetBrains Mono", monospace;
                padding: 0.2rem 0.6rem;
                border-radius: 999px;
                background: #222222;
                color: #bbbbbb;
                display: inline-flex;
                align-items: center;
                gap: 0.25rem;
                transition: all 0.15s ease;
            }

            .code-copy-button:hover {
                background: rgba(245, 217, 10, 0.2);
                color: #f5d90a;
            }

            .code-copy-button:active {
                transform: translateY(1px);
            }

            /* Copied state */
            .code-copy-button.copied {
                background: rgba(0, 250, 123, 0.2);
                color: #00fa7b;
            }

            /* ===== SYNTAX HIGHLIGHTING ===== */

            .hljs {
                background: transparent !important;
                color: #e4e4e7; /* base text */
            }

            /* Keywords: function, local, end, return, if, then */
            .hljs-keyword,
            .hljs-literal,
            .hljs-built_in {
                color: #c084fc; /* IDE purple */
                font-weight: 500;
            }

            /* Function calls + function definitions */
            .hljs-title.function,
            .hljs-title {
                color: #60a5fa; /* IDE blue */
                font-weight: 500;
            }

            /* Function parameters (if detected) */
            .hljs-params {
                color: #e4e4e7;
            }

            /* Strings "Hello" */
            .hljs-string {
                color: #67e8f9; /* cyan/teal */
            }

            /* Numbers 0, 1, 100 */
            .hljs-number {
                color: #facc15; /* soft gold */
            }

            /* Comments */
            .hljs-comment {
                color: #575757;
                font-style: italic;
            }

            /* UE types / structs: Vector, Rotator, etc */
            .hljs-type {
                color: #2dd4bf; /* teal */
                font-weight: 500;
            }

            /* Operators: + - = .. == */
            .hljs-operator {
                color: #a1a1aa;
            }

            /* Punctuation: (), {}, commas */
            .hljs-punctuation {
                color: #71717a;
            }

            .code-block-wrapper pre {
                background: transparent;
                margin: 0;
                padding: 1rem 1.25rem;
                overflow-x: auto;
            }

            .code-block-wrapper code {
                font-family: "JetBrains Mono", monospace;
                font-size: 0.85rem;
                color: #e4e4e7;
                line-height: 1.6;
            }

            /* ===== SCROLLBAR ===== */
            ::-webkit-scrollbar {
                width: 6px;
                height: 6px;
            }

            ::-webkit-scrollbar-track {
                background: transparent;
            }

            ::-webkit-scrollbar-thumb {
                background: #3b3b3b;
                border-radius: 100px;
            }

            ::-webkit-scrollbar-thumb:hover {
                background: #595959;
            }

            /* ===== SELECTION ===== */
            ::selection {
                background: rgba(245, 217, 10, 0.35);
                color: #0a0a0a;
            }
        </style>
    </head>
    <body>
        <div class="header">
            <div class="brand-logo">
                <img src="logo.png" />
            </div>

            <div class="header-main">
                <div class="search-container">
                    <input type="text" class="search-bar" id="searchBar" placeholder="Search classes or functions..." />
                </div>

                <div class="filter-bar">
                    <div class="filter-group">
                        <label>Category:</label>
                        <select id="categoryFilter" class="filter-select">
                            <option value="all">All</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label>API Set:</label>
                        <select id="apiSetFilter" class="filter-select">
                            <option value="all">All</option>
                            <option value="client">Client</option>
                            <option value="server">Server</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label>Type:</label>
                        <select id="typeFilter" class="filter-select">
                            <option value="all">All</option>
                            <option value="native">Native</option>
                            <option value="constructor">Constructor</option>
                            <option value="engine">Engine</option>
                        </select>
                    </div>
                    <!-- Keeping Language filter for visual consistency; it no longer changes anything -->
                    <!--
            <div class="filter-group">
                <label>Language:</label>
                <select id="languageFilter" class="filter-select">
                    <option value="lua">Lua</option>
                    <option value="js">JS</option>
                </select>
            </div>
            -->
                </div>
            </div>
        </div>

        <div class="main-container">
            <!-- LEFT: classes -->
            <div class="function-list" id="functionList">
                <div class="loading">Loading classes...</div>
            </div>

            <!-- RIGHT: functions for selected class -->
            <div class="detail-panel" id="detailPanel">
                <div class="no-selection">
                    <h2>Select a class to view its functions</h2>
                </div>
            </div>
        </div>
        <script>
            // ---------- Example helpers (Lua only) ----------

            function sampleValueForType(typeName, paramName) {
                if (!typeName) return "nil";

                const t = typeName.toLowerCase();
                const pname = (paramName || "value").toLowerCase();

                // strings / names
                if (t === "string" || t === "std::string" || t === "fstring" || t === "name" || t === "fname") {
                    return `"${paramName || "value"}"`;
                }

                // numbers
                if (t === "number" || t === "float" || t === "double" || t === "int" || t === "integer" || t === "int32" || t === "int64") {
                    return "0";
                }

                // booleans
                if (t === "boolean" || t === "bool") {
                    return "false";
                }

                if (t === "function") {
                    return "function()";
                }

                if (t === "...") {
                    return "params";
                }

                if (t === "fvector2d" || t === "vector2d") {
                    return "Vector2D(0, 0)";
                }
                if (t === "fvector" || t === "vector") {
                    return "Vector(0, 0, 0)";
                }
                if (t === "frotator" || t === "rotator") {
                    return "Rotator(0, 0, 0)";
                }
                if (t === "ftransform" || t === "transform") {
                    return "Transform(Rotator():ToQuat(), Vector(), Vector())";
                }
                if (t === "fcolor" || t === "color") {
                    return "Color(1, 1, 1, 1)";
                }
                if (t === "flinearcolor" || t === "linearcolor") {
                    return "LinearColor(1, 1, 1, 1)";
                }
                if (t === "fquat" || t === "quat") {
                    return "Quat(0, 0, 0, 0)";
                }

                // containers
                if (t.startsWith("tarray<") || t.startsWith("tset<") || t.startsWith("tmap<") || t === "table") {
                    return "{}";
                }

                // TSubclassOf / class types → usually passed as nil or some class reference
                if (t.startsWith("tsubclassof") || t.endsWith("_class")) {
                    return "nil";
                }

                // UObject / AActor / UActorComponent / etc → nil is safe
                if (/^u[a-z0-9_]/.test(t) || /^a[a-z0-9_]/.test(t)) {
                    return "nil";
                }

                // fallback for everything else: don't invent constructors, just nil
                return "nil";
            }

            function sampleValueForParam(p) {
                const name = (p.name || "").toLowerCase();
                const type = (p.type || "").toLowerCase();

                if (name.startsWith("is") || name.startsWith("has") || type === "bool" || type === "boolean") {
                    return "false";
                }
                if (name.includes("count") || name.includes("index") || name.includes("id")) {
                    return "0";
                }
                if (name.includes("name") || name.includes("title") || name.includes("text")) {
                    return `"${p.name || "text"}"`;
                }

                return sampleValueForType(p.type, p.name);
            }

            function highlightCodeBlocks(root) {
                if (window.hljs && root) {
                    root.querySelectorAll("pre code").forEach((el) => {
                        hljs.highlightElement(el);
                    });
                }
            }

            function copyTextToClipboard(text, buttonEl) {
                const showCopied = () => {
                    if (!buttonEl) return;
                    const original = buttonEl.textContent;
                    buttonEl.textContent = "Copied";
                    buttonEl.classList.add("copied");
                    setTimeout(() => {
                        buttonEl.textContent = original;
                        buttonEl.classList.remove("copied");
                    }, 1500);
                };

                if (navigator.clipboard && navigator.clipboard.writeText) {
                    navigator.clipboard
                        .writeText(text)
                        .then(showCopied)
                        .catch(() => {
                            fallbackCopyText(text);
                            showCopied();
                        });
                } else {
                    fallbackCopyText(text);
                    showCopied();
                }
            }

            function fallbackCopyText(text) {
                const textarea = document.createElement("textarea");
                textarea.value = text;
                textarea.style.position = "fixed";
                textarea.style.opacity = "0";
                textarea.style.left = "-9999px";
                document.body.appendChild(textarea);
                textarea.select();
                try {
                    document.execCommand("copy");
                } catch (e) {
                    console.warn("Copy failed", e);
                }
                document.body.removeChild(textarea);
            }

            function generateLuaExample(func) {
                const params = func.parameters || [];

                // 1) Setup locals based on param names/types
                const setupLines = [];

                params.forEach((p) => {
                    const paramName = p.name && p.name.trim().length > 0 ? p.name : "param";
                    const sample = sampleValueForParam(p);
                    setupLines.push(`local ${paramName} = ${sample}`);
                });

                // 2) Work out Class / operator
                let qualifier = "";
                let callOp = "";

                if (func.className && func.callStyle === ":") {
                    qualifier = func.className;
                    callOp = ":";
                } else if (func.className && func.callStyle === ".") {
                    qualifier = func.className;
                    callOp = ".";
                } else {
                    qualifier = "";
                    callOp = "";
                }

                const argList = params.map((p) => (p.name && p.name.trim().length > 0 ? p.name : "param")).join(", ");

                let callText;
                if (qualifier) {
                    callText = `${qualifier}${callOp}${func.name}(${argList})`;
                } else {
                    callText = `${func.name}(${argList})`;
                }

                const returns = func.returns || { type: "void" };
                let finalCall = callText;

                if (returns.type && returns.type.toLowerCase() !== "void") {
                    finalCall = `local result = ${callText}`;
                }

                // 3) Assemble the full example
                const lines = [];

                if (setupLines.length > 0) {
                    lines.push(...setupLines, ""); // blank line before call
                }

                lines.push(finalCall);

                return lines.join("\n");
            }

            // ---------- Main Application State ----------

            let allFunctions = [];
            let filteredFunctions = [];
            let classMap = {};
            let selectedClassKey = null;

            // ---------- UI + Filtering ----------

            function populateCategoryFilter() {
                const categories = [...new Set(allFunctions.map((f) => f.category).filter((c) => c && c.trim().length > 0))].sort();

                const categoryFilter = document.getElementById("categoryFilter");
                categoryFilter.innerHTML = '<option value="all">All</option>';

                categories.forEach((category) => {
                    const option = document.createElement("option");
                    option.value = category.toLowerCase();
                    option.textContent = category;
                    categoryFilter.appendChild(option);
                });
            }

            function applyFiltersAndRender() {
                const searchTerm = document.getElementById("searchBar").value.toLowerCase() || "";
                const categoryFilter = document.getElementById("categoryFilter").value;
                const apiSetFilter = document.getElementById("apiSetFilter").value;
                const typeFilter = document.getElementById("typeFilter").value;

                filteredFunctions = allFunctions.filter((func) => {
                    const haystack = (func.name + " " + (func.description || "") + " " + (func.className || "") + " " + (func.category || "") + " " + (func.folderCategory || "")).toLowerCase();

                    if (searchTerm && !haystack.includes(searchTerm)) return false;

                    if (categoryFilter !== "all") {
                        const cat = (func.category || func.folderCategory || "").toLowerCase();
                        if (cat !== categoryFilter) return false;
                    }

                    if (apiSetFilter !== "all") {
                        if (Array.isArray(func.apiSet)) {
                            if (!func.apiSet.includes(apiSetFilter)) return false;
                        } else if (func.apiSet !== apiSetFilter) {
                            return false;
                        }
                    }

                    if (typeFilter !== "all" && func.type !== typeFilter) {
                        return false;
                    }

                    return true;
                });

                classMap = {};
                for (const func of filteredFunctions) {
                    const key = func.className || func.category || func.folderCategory || "Global";

                    if (!classMap[key]) {
                        classMap[key] = {
                            key,
                            name: key,
                            functions: [],
                            properties: [],
                        };
                    }

                    // pick up properties once per class (from any function)
                    if (func.properties && func.properties.length > 0 && classMap[key].properties.length === 0) {
                        classMap[key].properties = func.properties;
                    }

                    classMap[key].functions.push(func);
                }

                const classKeys = Object.keys(classMap).sort((a, b) => a.localeCompare(b));

                if (!selectedClassKey || !classMap[selectedClassKey]) {
                    selectedClassKey = classKeys[0] || null;
                }

                renderClassList(classKeys);
                renderClassDetail(selectedClassKey);
            }

            function renderClassList(classKeys) {
                const listEl = document.getElementById("functionList");
                listEl.innerHTML = "";

                if (classKeys.length === 0) {
                    listEl.innerHTML = '<div class="loading">No classes found</div>';
                    const detailEl = document.getElementById("detailPanel");
                    detailEl.innerHTML = '<div class="no-selection"><h2>No classes match the current filters</h2></div>';
                    return;
                }

                for (const key of classKeys) {
                    const group = classMap[key];

                    const item = document.createElement("div");
                    item.className = "function-item" + (key === selectedClassKey ? " active" : "");
                    item.innerHTML = `
                <div class="function-name">${group.name}</div>
                <div class="function-meta">${group.functions.length} function${group.functions.length === 1 ? "" : "s"}</div>
            `;

                    item.addEventListener("click", () => {
                        selectedClassKey = key;
                        renderClassList(classKeys);
                        renderClassDetail(key);
                    });

                    listEl.appendChild(item);
                }
            }

            function renderClassDetail(classKey) {
                const detailEl = document.getElementById("detailPanel");
                detailEl.innerHTML = "";

                const group = classMap[classKey];
                if (!group) {
                    detailEl.innerHTML = '<div class="no-selection"><h2>Select a class to view its functions</h2></div>';
                    return;
                }

                const functions = group.functions.slice().sort((a, b) => a.name.localeCompare(b.name));

                const wrapper = document.createElement("div");
                wrapper.className = "detail-content";

                const title = document.createElement("h1");
                title.textContent = group.name;
                wrapper.appendChild(title);

                let classDescription = group.classDescription || (functions[0] && functions[0].classDescription) || "";

                if (classDescription) {
                    const sectionTitle = document.createElement("div");
                    sectionTitle.className = "section-title";
                    sectionTitle.textContent = "Description";
                    wrapper.appendChild(sectionTitle);

                    const desc = document.createElement("p");
                    desc.className = "description-context";
                    desc.textContent = classDescription;
                    wrapper.appendChild(desc);
                }
                if (group.properties && group.properties.length > 0) {
                    const propTitle = document.createElement("h3");
                    propTitle.className = "section-title";
                    propTitle.textContent = "Properties";
                    wrapper.appendChild(propTitle);

                    const propList = document.createElement("ul");
                    propList.className = "property-list";

                    group.properties.forEach((prop) => {
                        const li = document.createElement("li");
                        li.innerHTML = `
        <span class="property-name">${prop.name}</span>
        <span class="property-type">${prop.type}</span>
        ${prop.description ? `<span class="property-description">${prop.description}</span>` : ""}
    `;
                        propList.appendChild(li);
                    });

                    wrapper.appendChild(propList);
                }

                const funcsContainer = document.createElement("div");
                funcsContainer.className = "class-functions";

                functions.forEach((func) => {
                    const card = document.createElement("div");
                    card.className = "function-card";

                    const header = document.createElement("div");
                    header.className = "function-card-header";

                    const nameEl = document.createElement("h2");
                    nameEl.textContent = func.name;
                    header.appendChild(nameEl);

                    const badges = document.createElement("div");
                    badges.className = "function-badges";

                    // apiSet badge
                    const apiBadge = document.createElement("span");

                    let apiValue = "Unknown";
                    let apiClass = "unknown";

                    if (Array.isArray(func.apiSet)) {
                        apiValue = func.apiSet.join(" / "); // e.g. "client / server"
                        apiClass = "shared";
                    } else if (typeof func.apiSet === "string") {
                        apiValue = func.apiSet;
                        apiClass = func.apiSet.toLowerCase(); // "client", "server"
                    }

                    apiBadge.className = `api-set-badge ${apiClass}`;
                    apiBadge.textContent = apiValue;

                    badges.appendChild(apiBadge);

                    // type badge
                    const typeBadge = document.createElement("span");
                    typeBadge.className = "type-badge " + (func.type || "general");
                    typeBadge.textContent = func.type || "general";
                    badges.appendChild(typeBadge);

                    header.appendChild(badges);
                    card.appendChild(header);

                    const desc = document.createElement("p");
                    desc.className = "function-description";
                    desc.textContent = func.description || "No description available.";
                    card.appendChild(desc);

                    // Parameters
                    const paramsTitle = document.createElement("h3");
                    paramsTitle.className = "section-title";
                    paramsTitle.textContent = "Parameters";
                    card.appendChild(paramsTitle);

                    if (func.parameters && func.parameters.length > 0) {
                        const ul = document.createElement("ul");
                        ul.className = "param-list";
                        func.parameters.forEach((p) => {
                            const li = document.createElement("li");
                            let modifier = "";
                            if (p.modifier === "opt") {
                                modifier = '<span class="param-modifier">[optional]</span>';
                            } else if (p.modifier === "out") {
                                modifier = '<span class="param-modifier">[output]</span>';
                            }
                            li.innerHTML = `
                        <span class="param-name">${p.name}</span>
                        <span class="param-type">${p.type}</span>
                        ${modifier}
                        ${p.description ? " - " + p.description : ""}
                    `;
                            ul.appendChild(li);
                        });
                        card.appendChild(ul);
                    } else {
                        const p = document.createElement("p");
                        p.className = "dim";
                        p.textContent = "No parameters.";
                        card.appendChild(p);
                    }

                    // Returns
                    const returnsTitle = document.createElement("h3");
                    returnsTitle.className = "section-title";
                    returnsTitle.textContent = "Returns";
                    card.appendChild(returnsTitle);

                    const returns = func.returns || {
                        type: "void",
                        description: "",
                    };
                    const returnsList = document.createElement("ul");
                    returnsList.className = "return-list";

                    const li = document.createElement("li");
                    li.innerHTML = `<span class="param-type">${returns.type}</span>${returns.description ? " - " + returns.description : ""}`;
                    returnsList.appendChild(li);
                    card.appendChild(returnsList);

                    const exampleTitle = document.createElement("h3");
                    exampleTitle.className = "section-title";
                    exampleTitle.textContent = "Example";
                    card.appendChild(exampleTitle);

                    const codeWrapper = document.createElement("div");
                    codeWrapper.className = "code-block-wrapper";

                    // Header (label + copy button)
                    const label = document.createElement("div");
                    label.className = "code-label";

                    const labelText = document.createElement("span");
                    labelText.textContent = "Lua";

                    const copyButton = document.createElement("button");
                    copyButton.className = "code-copy-button";
                    copyButton.type = "button";
                    copyButton.textContent = "Copy";

                    // attach click handler
                    copyButton.addEventListener("click", () => {
                        const codeEl = codeWrapper.querySelector("pre code");
                        if (!codeEl) return;

                        const text = codeEl.innerText || codeEl.textContent || "";
                        if (!text) return;

                        copyTextToClipboard(text, copyButton);
                    });

                    label.appendChild(labelText);
                    label.appendChild(copyButton);
                    codeWrapper.appendChild(label);

                    // Code body
                    const pre = document.createElement("pre");
                    const code = document.createElement("code");
                    code.className = "language-lua";
                    code.textContent = generateLuaExample(func);
                    pre.appendChild(code);
                    codeWrapper.appendChild(pre);

                    card.appendChild(codeWrapper);

                    funcsContainer.appendChild(card);
                });

                wrapper.appendChild(funcsContainer);
                detailEl.appendChild(wrapper);

                highlightCodeBlocks(wrapper);
            }

            // ---------- Data load from pre-generated JSON ----------

            async function loadFunctions() {
                const listEl = document.getElementById("functionList");
                listEl.innerHTML = '<div class="loading">Loading classes...</div>';

                try {
                    const response = await fetch("docs-index.json");
                    if (!response.ok) {
                        throw new Error("Failed to load docs-index.json");
                    }

                    const functionsFromJson = await response.json();

                    // docs-index.json is already merged/processed by your Node script
                    allFunctions = functionsFromJson;
                    filteredFunctions = [...allFunctions];

                    populateCategoryFilter();
                    applyFiltersAndRender();
                } catch (error) {
                    console.error("Error loading functions:", error);
                    listEl.innerHTML = '<div class="loading">Error loading classes. Check console for details.</div>';
                }
            }

            // ---------- Event wiring ----------

            document.getElementById("searchBar").addEventListener("input", () => {
                applyFiltersAndRender();
            });

            document.getElementById("categoryFilter").addEventListener("change", () => {
                applyFiltersAndRender();
            });

            document.getElementById("apiSetFilter").addEventListener("change", () => {
                applyFiltersAndRender();
            });

            document.getElementById("typeFilter").addEventListener("change", () => {
                applyFiltersAndRender();
            });

            // Language filter kept for UI; no behavior now
            // document.getElementById("languageFilter").addEventListener("change", () => {
            //     // Intentionally does nothing; syntax/examples removed
            // });

            // Initialize
            loadFunctions();
        </script>
    </body>
</html>
