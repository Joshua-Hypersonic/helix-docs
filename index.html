<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Native Functions Documentation</title>
        <style>
            @import url("https://fonts.googleapis.com/css2?family=Tomorrow:wght@300;400;500;600;700&display=swap");
            @import url("https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap");
            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
            }

            body {
                font-family: "Inter", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
                background: linear-gradient(180deg, #0a0a0b 0%, #111114 100%);
                color: #e4e4e7;
                height: 100vh;
                display: flex;
                flex-direction: column;
                overflow: hidden;
                -webkit-font-smoothing: antialiased;
                -moz-osx-font-smoothing: grayscale;
            }

            #root {
                height: 100vh;
                display: flex;
                flex-direction: column;
            }

            /* ===== HEADER ===== */
            .header {
                background: rgba(10, 10, 11, 0.8);
                backdrop-filter: blur(12px);
                -webkit-backdrop-filter: blur(12px);
                padding: 1.25rem 2rem;
                border-bottom: 1px solid rgba(255, 255, 255, 0.06);
                position: sticky;
                top: 0;
                z-index: 100;
            }

            h1 {
                font-family: "Tomorrow", sans-serif;
                font-weight: 600;
            }

            .search-container {
                max-width: 560px;
                margin: 0 auto 1.25rem auto;
            }

            .search-bar {
                width: 100%;
                padding: 0.875rem 1.25rem;
                background: rgba(255, 255, 255, 0.04);
                border: 1px solid rgba(255, 255, 255, 0.08);
                border-radius: 12px;
                color: #f4f4f5;
                font-size: 0.9rem;
                font-family: inherit;
                transition: all 0.2s ease;
            }

            .search-bar::placeholder {
                color: #71717a;
            }

            .search-bar:hover {
                border-color: rgba(255, 255, 255, 0.12);
                background: rgba(255, 255, 255, 0.06);
            }

            .search-bar:focus {
                outline: none;
                border-color: #3b82f6;
                background: rgba(59, 130, 246, 0.08);
                box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.15);
            }

            .filter-bar {
                display: flex;
                justify-content: center;
                gap: 1.5rem;
                align-items: center;
                flex-wrap: wrap;
            }

            .filter-group {
                display: flex;
                align-items: center;
                gap: 0.5rem;
                font-size: 0.8rem;
                color: #71717a;
            }

            .filter-group label {
                font-weight: 500;
            }

            .filter-select {
                padding: 0.5rem 0.75rem;
                background: rgba(255, 255, 255, 0.04);
                border: 1px solid rgba(255, 255, 255, 0.08);
                border-radius: 8px;
                color: #a1a1aa;
                font-size: 0.8rem;
                font-family: inherit;
                cursor: pointer;
                transition: all 0.15s ease;
            }

            .filter-select option {
                background-color: #18181b;
                color: #e4e4e7;
            }

            .filter-select:hover {
                border-color: rgba(255, 255, 255, 0.15);
                color: #e4e4e7;
            }

            .filter-select:focus {
                outline: none;
                border-color: #3b82f6;
            }

            /* ===== MAIN LAYOUT ===== */
            .main-container {
                display: flex;
                flex: 1;
                min-height: 0;
            }

            /* ===== SIDEBAR ===== */
            .function-list {
                width: 320px;
                background: rgba(10, 10, 11, 0.6);
                border-right: 1px solid rgba(255, 255, 255, 0.06);
                overflow-y: auto;
                padding: 0.5rem;
            }

            .function-item {
                padding: 0.875rem 1rem;
                margin: 0.25rem 0;
                border-radius: 10px;
                cursor: pointer;
                transition: all 0.15s ease;
                border: 1px solid transparent;
            }

            .function-item:hover {
                background: rgba(255, 255, 255, 0.04);
            }

            .function-item.active {
                background: linear-gradient(135deg, rgba(59, 130, 246, 0.12) 0%, rgba(139, 92, 246, 0.08) 100%);
                border-color: rgba(59, 130, 246, 0.2);
            }

            .function-name {
                font-size: 0.9rem;
                font-weight: 500;
                color: #f4f4f5;
                letter-spacing: -0.01em;
            }

            .function-item.active .function-name {
                color: #60a5fa;
            }

            .function-meta {
                font-size: 0.75rem;
                color: #52525b;
                margin-top: 0.35rem;
                font-weight: 400;
            }

            /* ===== DETAIL PANEL ===== */
            .detail-panel {
                flex: 1;
                padding: 2.5rem 3rem;
                overflow-y: auto;
                background: linear-gradient(135deg, #0f0f12 0%, #111114 100%);
            }

            .detail-content h1 {
                font-size: 2.25rem;
                font-weight: 700;
                letter-spacing: -0.03em;
                background: linear-gradient(135deg, #f4f4f5 0%, #a1a1aa 100%);
                -webkit-background-clip: text;
                -webkit-text-fill-color: transparent;
                background-clip: text;
                margin-bottom: 0.75rem;
            }

            .category-badge {
                display: inline-flex;
                align-items: center;
                background: rgba(255, 255, 255, 0.06);
                padding: 0.35rem 0.85rem;
                border-radius: 100px;
                font-size: 0.75rem;
                font-weight: 500;
                color: #a1a1aa;
                margin-bottom: 2rem;
                letter-spacing: 0.02em;
                text-transform: uppercase;
            }

            /* ===== FUNCTION CARDS ===== */
            .class-functions {
                display: flex;
                flex-direction: column;
                gap: 1rem;
            }

            .function-card {
                background: rgba(255, 255, 255, 0.02);
                border-radius: 16px;
                padding: 1.5rem;
                border: 1px solid rgba(255, 255, 255, 0.06);
                transition: all 0.2s ease;
            }

            .function-card:hover {
                border-color: rgba(255, 255, 255, 0.1);
                background: rgba(255, 255, 255, 0.03);
                transform: translateY(-1px);
            }

            .function-card-header {
                display: flex;
                justify-content: space-between;
                align-items: flex-start;
                margin-bottom: 0.75rem;
                gap: 1rem;
            }

            .function-card-header h2 {
                font-size: 1rem;
                font-weight: 600;
                color: #f4f4f5;
                font-family: "JetBrains Mono", monospace;
                letter-spacing: -0.01em;
            }

            .function-badges {
                display: flex;
                gap: 0.5rem;
                flex-shrink: 0;
            }

            .function-description {
                font-size: 0.875rem;
                color: #a1a1aa;
                line-height: 1.6;
                margin-bottom: 1.25rem;
            }

            /* ===== BADGES ===== */
            .api-set-badge,
            .type-badge {
                display: inline-flex;
                align-items: center;
                padding: 0.25rem 0.625rem;
                font-size: 0.7rem;
                font-weight: 500;
                border-radius: 6px;
                letter-spacing: 0.02em;
                text-transform: uppercase;
            }

            .api-set-badge.client {
                background: rgba(59, 130, 246, 0.15);
                color: #60a5fa;
            }

            .api-set-badge.server {
                background: rgba(34, 197, 94, 0.15);
                color: #4ade80;
            }

            .api-set-badge.shared {
                background: rgba(234, 179, 8, 0.15);
                color: #facc15;
            }

            .type-badge.native {
                background: rgba(251, 146, 60, 0.15);
                color: #fb923c;
            }

            .type-badge.constructor {
                background: rgba(168, 85, 247, 0.15);
                color: #c084fc;
            }

            .type-badge.engine {
                background: rgba(20, 184, 166, 0.15);
                color: #2dd4bf;
            }

            /* ===== SECTIONS ===== */
            .section-title {
                font-size: 0.7rem;
                font-weight: 600;
                color: #52525b;
                text-transform: uppercase;
                letter-spacing: 0.08em;
                margin-top: 1.25rem;
                margin-bottom: 0.75rem;
                padding-bottom: 0.5rem;
                border-bottom: 1px solid rgba(255, 255, 255, 0.06);
            }

            /* ===== PARAMETERS ===== */
            .param-list,
            .return-list {
                list-style: none;
                margin: 0.75rem 0;
                padding-left: 0;
                font-size: 0.9375rem;
            }

            .param-list li,
            .return-list li {
                padding: 0.875rem 1rem;
                background: #0d1117;
                border: 1px solid #30363d;
                margin-bottom: 0.5rem;
                border-radius: 6px;
                transition: all 0.15s ease;
            }

            .param-list li:last-child {
                border-bottom: none;
            }

            .param-name {
                font-family: "JetBrains Mono", monospace;
                font-weight: 500;
                color: #f0abfc;
                font-size: 0.8rem;
            }

            .param-type {
                font-family: "JetBrains Mono", monospace;
                color: #67e8f9;
                font-size: 0.8rem;
            }

            .param-modifier {
                font-size: 0.7rem;
                color: #fbbf24;
                font-weight: 500;
                background: rgba(251, 191, 36, 0.1);
                padding: 0.15rem 0.4rem;
                border-radius: 4px;
            }

            .dim {
                color: #52525b;
                font-size: 0.85rem;
                font-style: italic;
            }

            /* ===== STATES ===== */
            .loading {
                padding: 2rem;
                color: #52525b;
                text-align: center;
                font-size: 0.9rem;
            }

            .no-selection {
                display: flex;
                flex-direction: column;
                align-items: center;
                justify-content: center;
                height: 100%;
                color: #3f3f46;
                gap: 0.75rem;
            }

            .no-selection h2 {
                font-weight: 500;
                font-size: 1rem;
            }

            .no-selection::before {
                content: "";
                width: 48px;
                height: 48px;
                background: linear-gradient(135deg, rgba(59, 130, 246, 0.2) 0%, rgba(139, 92, 246, 0.2) 100%);
                border-radius: 12px;
                margin-bottom: 0.5rem;
            }

            /* ===== CODE BLOCKS ===== */
            .code-block-wrapper {
                border: 1px solid rgba(255, 255, 255, 0.06);
                border-radius: 12px;
                background: rgba(0, 0, 0, 0.3);
                margin-top: 0.75rem;
                overflow: hidden;
            }

            .code-label {
                background: rgba(255, 255, 255, 0.04);
                color: #52525b;
                font-size: 0.7rem;
                padding: 0.5rem 1rem;
                border-bottom: 1px solid rgba(255, 255, 255, 0.06);
                font-family: "JetBrains Mono", monospace;
                font-weight: 500;
                text-transform: uppercase;
                letter-spacing: 0.05em;
            }

            .code-block-wrapper pre {
                background: transparent;
                margin: 0;
                padding: 1rem 1.25rem;
                overflow-x: auto;
            }

            .code-block-wrapper code {
                font-family: "JetBrains Mono", monospace;
                font-size: 0.85rem;
                color: #e4e4e7;
                line-height: 1.6;
            }

            /* ===== SCROLLBAR ===== */
            ::-webkit-scrollbar {
                width: 6px;
                height: 6px;
            }

            ::-webkit-scrollbar-track {
                background: transparent;
            }

            ::-webkit-scrollbar-thumb {
                background: rgba(255, 255, 255, 0.1);
                border-radius: 100px;
            }

            ::-webkit-scrollbar-thumb:hover {
                background: rgba(255, 255, 255, 0.15);
            }

            /* ===== SELECTION ===== */
            ::selection {
                background: rgba(59, 130, 246, 0.3);
                color: #f4f4f5;
            }
        </style>
    </head>
    <body>
        <div class="header">
            <div class="search-container">
                <input type="text" class="search-bar" id="searchBar" placeholder="Search classes or functions..." />
            </div>
            <div class="filter-bar">
                <div class="filter-group">
                    <label>Category:</label>
                    <select id="categoryFilter" class="filter-select">
                        <option value="all">All</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label>API Set:</label>
                    <select id="apiSetFilter" class="filter-select">
                        <option value="all">All</option>
                        <option value="client">Client</option>
                        <option value="server">Server</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label>Type:</label>
                    <select id="typeFilter" class="filter-select">
                        <option value="all">All</option>
                        <option value="native">Native</option>
                        <option value="constructor">Constructor</option>
                        <option value="engine">Engine</option>
                    </select>
                </div>
                <!-- Keeping Language filter for visual consistency; it no longer changes anything -->
                <div class="filter-group">
                    <label>Language:</label>
                    <select id="languageFilter" class="filter-select">
                        <option value="lua">Lua</option>
                        <option value="js">JS</option>
                    </select>
                </div>
            </div>
        </div>

        <div class="main-container">
            <!-- LEFT: classes -->
            <div class="function-list" id="functionList">
                <div class="loading">Loading classes...</div>
            </div>

            <!-- RIGHT: functions for selected class -->
            <div class="detail-panel" id="detailPanel">
                <div class="no-selection">
                    <h2>Select a class to view its functions</h2>
                </div>
            </div>
        </div>

        <script>
            // LuaDoc Parser
            class LuaDocParser {
                parseLuaFile(content, filePath) {
                    const lines = content.split(/\r?\n/);
                    const functions = [];

                    let description = "";
                    let pendingParams = [];
                    let pendingReturn = { type: "void", description: "" };
                    let currentDocClass = null;

                    const pathParts = filePath.split("/");

                    // apiSet: client / server / unknown
                    let apiSet = "unknown";
                    if (pathParts[0] === "client" || pathParts[0] === "server") {
                        apiSet = pathParts[0];
                    }

                    // type: native / constructor / engine / general (2nd segment)
                    let type = "general";
                    if (pathParts[1]) {
                        type = pathParts[1];
                    }

                    // folder-based category from path
                    const fileName = pathParts[pathParts.length - 1] || "";
                    const fileBase = fileName.replace(/\.lua$/i, "");

                    let folderCategory = "misc";
                    if (pathParts.length > 3) {
                        // e.g. client/constructor/Actor/WebUI.lua → "Actor"
                        folderCategory = pathParts[pathParts.length - 2];
                    } else if (pathParts.length > 2) {
                        // e.g. client/constructor/Actor.lua → "Actor"
                        folderCategory = fileBase || "misc";
                    } else {
                        folderCategory = fileBase || "misc";
                    }

                    for (let i = 0; i < lines.length; i++) {
                        const line = lines[i].trim();

                        if (line.startsWith("---")) {
                            // Doc comment line
                            const comment = line.substring(3).trim();

                            if (comment.startsWith("@class")) {
                                const classMatch = comment.match(/@class\s+(\w+)/);
                                if (classMatch) {
                                    currentDocClass = classMatch[1];
                                }
                                continue;
                            }

                            if (comment.startsWith("@param")) {
                                const paramMatch = comment.match(/@param\s+(\S+)\s+(\S+)(?:\s+@\[(out|opt)\])?\s*(.*)/);
                                if (paramMatch) {
                                    const [, name, typeName, modifier, desc] = paramMatch;
                                    pendingParams.push({
                                        name,
                                        type: typeName,
                                        modifier: modifier || null,
                                        description: (desc || "").trim(),
                                    });
                                }
                                continue;
                            }

                            if (comment.startsWith("@return")) {
                                const returnMatch = comment.match(/@return\s+(\S+)(?:\s+(.*))?/);
                                if (returnMatch) {
                                    pendingReturn = {
                                        type: returnMatch[1],
                                        description: returnMatch[2] ? returnMatch[2].trim() : "",
                                    };
                                }
                                continue;
                            }

                            if (!comment.startsWith("@")) {
                                description += (description ? " " : "") + comment;
                            }

                            continue;
                        }

                        // Function signatures
                        if (line.startsWith("function") || line.startsWith("local function")) {
                            let classNameFromSig = null;
                            let functionName = null;
                            let params = "";
                            let callStyle = null; // ".", ":", or null for global

                            // Normalize to remove "local" prefix for matching
                            const sigLine = line.replace(/^local\s+/, "");

                            // function Class.Method(...)
                            let match = sigLine.match(/^function\s+([A-Za-z_]\w*)\.([A-Za-z_]\w*)\s*\((.*)\)/);
                            if (match) {
                                classNameFromSig = match[1];
                                functionName = match[2];
                                params = match[3];
                                callStyle = "."; // static / namespace style
                            } else {
                                // function Class:Method(...)
                                match = sigLine.match(/^function\s+([A-Za-z_]\w*):([A-Za-z_]\w*)\s*\((.*)\)/);
                                if (match) {
                                    classNameFromSig = match[1];
                                    functionName = match[2];
                                    params = match[3];
                                    callStyle = ":"; // instance style
                                } else {
                                    // function foo(...)
                                    match = sigLine.match(/^function\s+([A-Za-z_]\w*)\s*\((.*)\)/);
                                    if (match) {
                                        functionName = match[1];
                                        params = match[2];
                                        callStyle = null; // global / free function
                                    }
                                }
                            }

                            if (!functionName) {
                                // Not a recognized function pattern; clear doc state and continue
                                description = "";
                                pendingParams = [];
                                pendingReturn = { type: "void", description: "" };
                                continue;
                            }

                            const paramList = params
                                .split(",")
                                .map((p) => p.trim())
                                .filter((p) => p.length > 0);

                            // Ensure each param has a doc entry
                            if (pendingParams.length < paramList.length) {
                                for (let idx = pendingParams.length; idx < paramList.length; idx++) {
                                    const paramName = paramList[idx];
                                    pendingParams.push({
                                        name: paramName,
                                        type: "any",
                                        modifier: null,
                                        description: "",
                                    });
                                }
                            }

                            const logicalCategory = currentDocClass || folderCategory || "General";

                            const func = {
                                name: functionName,
                                category: logicalCategory,
                                folderCategory,
                                apiSet,
                                type,
                                description,
                                className: classNameFromSig || null,
                                callStyle, // <--- NEW
                                parameters: pendingParams.slice(),
                                returns: pendingReturn,
                                rawParams: params,
                            };

                            functions.push(func);

                            // Reset doc state after a function
                            description = "";
                            pendingParams = [];
                            pendingReturn = { type: "void", description: "" };
                            continue;
                        }

                        // Any other real code line: reset doc state
                        if (line !== "") {
                            description = "";
                            pendingParams = [];
                            pendingReturn = { type: "void", description: "" };
                        }
                    }

                    return functions;
                }
            }

            // ---------- Example helpers (Lua only) ----------

            function sampleValueForType(typeName, paramName) {
                if (!typeName) return "value";

                const t = typeName.toLowerCase();

                if (t === "string" || t === "std::string") return `"${paramName || "text"}"`;
                if (t === "number" || t === "float" || t === "double" || t === "int") return "0";
                if (t === "boolean" || t === "bool") return "true";
                if (t === "table") return "{}";
                if (t === "function") return "function() end";
                if (t === "vector" || t === "vector3") return "Vector(0, 0, 0)";
                if (t === "color" || t === "colour") return "Color(255, 255, 255)";

                // Class-like types: start with uppercase letter
                if (/^[A-Z]\w*$/.test(typeName)) return `${typeName}.new()`;

                return "value";
            }

            function sampleValueForParam(p) {
                const name = (p.name || "").toLowerCase();
                const type = (p.type || "").toLowerCase();

                if (name.startsWith("is") || name.startsWith("has") || type === "bool" || type === "boolean") {
                    return "true";
                }
                if (name.includes("count") || name.includes("index") || name.includes("id")) {
                    return "0";
                }
                if (name.includes("name") || name.includes("title") || name.includes("text")) {
                    return `"${p.name || "text"}"`;
                }

                return sampleValueForType(p.type, p.name);
            }

            function generateLuaExample(func) {
                // Work out Class / operator
                let qualifier = "";
                let callOp = "";

                if (func.className && func.callStyle === ":") {
                    qualifier = func.className;
                    callOp = ":";
                } else if (func.className && func.callStyle === ".") {
                    qualifier = func.className;
                    callOp = ".";
                } else {
                    qualifier = "";
                    callOp = "";
                }

                const args = (func.parameters || []).map((p) => sampleValueForParam(p)).join(", ");

                let callText;
                if (qualifier) {
                    callText = `${qualifier}${callOp}${func.name}(${args})`;
                } else {
                    callText = `${func.name}(${args})`;
                }

                const returns = func.returns || { type: "void" };
                if (returns.type && returns.type.toLowerCase() !== "void") {
                    return `local result = ${callText}`;
                }

                return callText;
            }

            // GitHub Configuration
            const GITHUB_OWNER = "Joshua-Hypersonic";
            const GITHUB_REPO = "helix-docs";
            const GITHUB_BRANCH = "main";
            const DOCS_PATH = "docs";

            // Main Application State
            let allFunctions = [];
            let filteredFunctions = [];
            let classMap = {};
            let selectedClassKey = null;

            async function fetchGitHubDirectory(path) {
                const url = `https://api.github.com/repos/${GITHUB_OWNER}/${GITHUB_REPO}/contents/${path}?ref=${GITHUB_BRANCH}`;
                try {
                    const response = await fetch(url);
                    if (!response.ok) {
                        console.error(`Failed to fetch directory: ${path}`);
                        return [];
                    }
                    return await response.json();
                } catch (error) {
                    console.error(`Error fetching directory ${path}:`, error);
                    return [];
                }
            }

            async function fetchGitHubFile(path) {
                const url = `https://raw.githubusercontent.com/${GITHUB_OWNER}/${GITHUB_REPO}/${GITHUB_BRANCH}/${path}`;
                try {
                    const response = await fetch(url);
                    if (!response.ok) {
                        console.error(`Failed to fetch file: ${path}`);
                        return null;
                    }
                    return await response.text();
                } catch (error) {
                    console.error(`Error fetching file ${path}:`, error);
                    return null;
                }
            }

            async function recursivelyFindLuaFiles(path, relativePath = "") {
                const files = [];
                const contents = await fetchGitHubDirectory(path);

                for (const item of contents) {
                    const itemRelativePath = relativePath ? `${relativePath}/${item.name}` : item.name;

                    if (item.type === "file" && item.name.endsWith(".lua")) {
                        files.push({
                            path: item.path,
                            relativePath: itemRelativePath,
                        });
                    } else if (item.type === "dir") {
                        const subFiles = await recursivelyFindLuaFiles(item.path, itemRelativePath);
                        files.push(...subFiles);
                    }
                }

                return files;
            }

            function populateCategoryFilter() {
                const categories = [...new Set(allFunctions.map((f) => f.category).filter((c) => c && c.trim().length > 0))].sort();

                const categoryFilter = document.getElementById("categoryFilter");
                categoryFilter.innerHTML = '<option value="all">All</option>';

                categories.forEach((category) => {
                    const option = document.createElement("option");
                    option.value = category.toLowerCase();
                    option.textContent = category;
                    categoryFilter.appendChild(option);
                });
            }

            function applyFiltersAndRender() {
                const searchTerm = document.getElementById("searchBar").value.toLowerCase() || "";
                const categoryFilter = document.getElementById("categoryFilter").value;
                const apiSetFilter = document.getElementById("apiSetFilter").value;
                const typeFilter = document.getElementById("typeFilter").value;

                filteredFunctions = allFunctions.filter((func) => {
                    const haystack = (func.name + " " + (func.description || "") + " " + (func.className || "") + " " + (func.category || "") + " " + (func.folderCategory || "")).toLowerCase();

                    if (searchTerm && !haystack.includes(searchTerm)) return false;

                    if (categoryFilter !== "all") {
                        const cat = (func.category || func.folderCategory || "").toLowerCase();
                        if (cat !== categoryFilter) return false;
                    }

                    if (apiSetFilter !== "all") {
                        if (Array.isArray(func.apiSet)) {
                            if (!func.apiSet.includes(apiSetFilter)) return false;
                        } else if (func.apiSet !== apiSetFilter) {
                            return false;
                        }
                    }

                    if (typeFilter !== "all" && func.type !== typeFilter) {
                        return false;
                    }

                    return true;
                });

                classMap = {};
                for (const func of filteredFunctions) {
                    const key = func.className || func.category || func.folderCategory || "Global";

                    if (!classMap[key]) {
                        classMap[key] = {
                            key,
                            name: key,
                            functions: [],
                        };
                    }
                    classMap[key].functions.push(func);
                }

                const classKeys = Object.keys(classMap).sort((a, b) => a.localeCompare(b));

                if (!selectedClassKey || !classMap[selectedClassKey]) {
                    selectedClassKey = classKeys[0] || null;
                }

                renderClassList(classKeys);
                renderClassDetail(selectedClassKey);
            }

            function renderClassList(classKeys) {
                const listEl = document.getElementById("functionList");
                listEl.innerHTML = "";

                if (classKeys.length === 0) {
                    listEl.innerHTML = '<div class="loading">No classes found</div>';
                    const detailEl = document.getElementById("detailPanel");
                    detailEl.innerHTML = '<div class="no-selection"><h2>No classes match the current filters</h2></div>';
                    return;
                }

                for (const key of classKeys) {
                    const group = classMap[key];

                    const item = document.createElement("div");
                    item.className = "function-item" + (key === selectedClassKey ? " active" : "");
                    item.innerHTML = `
                        <div class="function-name">${group.name}</div>
                        <div class="function-meta">${group.functions.length} function${group.functions.length === 1 ? "" : "s"}</div>
                    `;

                    item.addEventListener("click", () => {
                        selectedClassKey = key;
                        renderClassList(classKeys);
                        renderClassDetail(key);
                    });

                    listEl.appendChild(item);
                }
            }

            function renderClassDetail(classKey) {
                const detailEl = document.getElementById("detailPanel");
                detailEl.innerHTML = "";

                const group = classMap[classKey];
                if (!group) {
                    detailEl.innerHTML = '<div class="no-selection"><h2>Select a class to view its functions</h2></div>';
                    return;
                }

                const functions = group.functions.slice().sort((a, b) => a.name.localeCompare(b.name));

                const wrapper = document.createElement("div");
                wrapper.className = "detail-content";

                const title = document.createElement("h1");
                title.textContent = group.name;
                wrapper.appendChild(title);

                const badge = document.createElement("span");
                badge.className = "category-badge";
                badge.textContent = `Functions: ${functions.length}`;
                wrapper.appendChild(badge);

                const funcsContainer = document.createElement("div");
                funcsContainer.className = "class-functions";

                functions.forEach((func) => {
                    const card = document.createElement("div");
                    card.className = "function-card";

                    const header = document.createElement("div");
                    header.className = "function-card-header";

                    const nameEl = document.createElement("h2");
                    nameEl.textContent = func.name;
                    header.appendChild(nameEl);

                    const badges = document.createElement("div");
                    badges.className = "function-badges";

                    // apiSet badge
                    const apiBadge = document.createElement("span");

                    let apiValue = "Unknown";
                    let apiClass = "unknown";

                    if (Array.isArray(func.apiSet)) {
                        apiValue = func.apiSet.join(" / "); // Displays "client / server"
                        apiClass = "shared"; // Apply the shared CSS class
                    } else if (typeof func.apiSet === "string") {
                        apiValue = func.apiSet;
                        apiClass = func.apiSet.toLowerCase(); // "client", "server"
                    }

                    apiBadge.className = `api-set-badge ${apiClass}`;
                    apiBadge.textContent = apiValue;

                    badges.appendChild(apiBadge);

                    // type badge
                    const typeBadge = document.createElement("span");
                    typeBadge.className = "type-badge " + (func.type || "general");
                    typeBadge.textContent = func.type || "general";
                    badges.appendChild(typeBadge);

                    header.appendChild(badges);
                    card.appendChild(header);

                    const desc = document.createElement("p");
                    desc.className = "function-description";
                    desc.textContent = func.description || "No description available.";
                    card.appendChild(desc);

                    // Parameters
                    const paramsTitle = document.createElement("h3");
                    paramsTitle.className = "section-title";
                    paramsTitle.textContent = "Parameters";
                    card.appendChild(paramsTitle);

                    if (func.parameters && func.parameters.length > 0) {
                        const ul = document.createElement("ul");
                        ul.className = "param-list";
                        func.parameters.forEach((p) => {
                            const li = document.createElement("li");
                            let modifier = "";
                            if (p.modifier === "opt") {
                                modifier = '<span class="param-modifier">[optional]</span>';
                            } else if (p.modifier === "out") {
                                modifier = '<span class="param-modifier">[output]</span>';
                            }
                            li.innerHTML = `
                                <span class="param-name">${p.name}</span>
                                <span class="param-type">${p.type}</span>
                                ${modifier}
                                ${p.description ? " - " + p.description : ""}
                            `;
                            ul.appendChild(li);
                        });
                        card.appendChild(ul);
                    } else {
                        const p = document.createElement("p");
                        p.className = "dim";
                        p.textContent = "No parameters.";
                        card.appendChild(p);
                    }

                    // Returns
                    const returnsTitle = document.createElement("h3");
                    returnsTitle.className = "section-title";
                    returnsTitle.textContent = "Returns";
                    card.appendChild(returnsTitle);

                    const returns = func.returns || {
                        type: "void",
                        description: "",
                    };
                    const returnsList = document.createElement("ul");
                    returnsList.className = "return-list";

                    const li = document.createElement("li");
                    li.innerHTML = `<span class="param-type">${returns.type}</span>${returns.description ? " - " + returns.description : ""}`;
                    returnsList.appendChild(li);
                    card.appendChild(returnsList);

                    const exampleTitle = document.createElement("h3");
                    exampleTitle.className = "section-title";
                    exampleTitle.textContent = "Example";
                    card.appendChild(exampleTitle);

                    const wrapper = document.createElement("div");
                    wrapper.className = "code-block-wrapper";

                    const label = document.createElement("div");
                    label.className = "code-label";
                    label.textContent = "Lua";
                    wrapper.appendChild(label);

                    const pre = document.createElement("pre");
                    const code = document.createElement("code");
                    code.textContent = generateLuaExample(func);
                    pre.appendChild(code);
                    wrapper.appendChild(pre);

                    card.appendChild(wrapper);

                    funcsContainer.appendChild(card);
                });

                wrapper.appendChild(funcsContainer);
                detailEl.appendChild(wrapper);
            }

            async function loadFunctions() {
                const listEl = document.getElementById("functionList");
                listEl.innerHTML = '<div class="loading">Loading classes from GitHub...</div>';

                try {
                    const parser = new LuaDocParser();

                    const clientFiles = await recursivelyFindLuaFiles(`${DOCS_PATH}/client`, "client");
                    const serverFiles = await recursivelyFindLuaFiles(`${DOCS_PATH}/server`, "server");
                    const allFiles = [...clientFiles, ...serverFiles];

                    const functionMap = new Map();

                    for (const file of allFiles) {
                        const content = await fetchGitHubFile(file.path);
                        if (!content) continue;

                        const parsed = parser.parseLuaFile(content, file.relativePath);

                        for (const func of parsed) {
                            const key = func.className ? `${func.className}.${func.name}` : func.name;

                            if (functionMap.has(key)) {
                                const existing = functionMap.get(key);
                                if (!Array.isArray(existing.apiSet)) {
                                    existing.apiSet = [existing.apiSet];
                                }
                                if (func.apiSet && !existing.apiSet.includes(func.apiSet)) {
                                    existing.apiSet.push(func.apiSet);
                                }
                            } else {
                                functionMap.set(key, func);
                            }
                        }
                    }

                    allFunctions = Array.from(functionMap.values());
                    filteredFunctions = [...allFunctions];

                    populateCategoryFilter();
                    applyFiltersAndRender();
                } catch (error) {
                    console.error("Error loading functions:", error);
                    listEl.innerHTML = '<div class="loading">Error loading classes. Check console for details.</div>';
                }
            }

            // Event wiring
            document.getElementById("searchBar").addEventListener("input", () => {
                applyFiltersAndRender();
            });

            document.getElementById("categoryFilter").addEventListener("change", () => {
                applyFiltersAndRender();
            });

            document.getElementById("apiSetFilter").addEventListener("change", () => {
                applyFiltersAndRender();
            });

            document.getElementById("typeFilter").addEventListener("change", () => {
                applyFiltersAndRender();
            });

            // Language filter kept for UI; no behavior now
            document.getElementById("languageFilter").addEventListener("change", () => {
                // Intentionally does nothing; syntax/examples removed
            });

            // Initialize
            loadFunctions();
        </script>
    </body>
</html>
